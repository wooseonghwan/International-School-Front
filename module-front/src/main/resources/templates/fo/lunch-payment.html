<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainLayout}">
<div layout:fragment="contents" th:remove="tag">
    <div class="main-container">
        <div class="container">
            <div class="info-card-wrap row">
                <div class="col-12 col-lg-6">
                    <div class="img-card">
                        <img src="/static/images/payment-img-card.svg" alt=""/>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="desc-card">
                        <div>
                            <div class="form-wrap disabled">
                                <p class="form-title">이름</p>
                                <input type="text" class="form-control form-lg" placeholder="" value="Byoung Gul Cho"
                                       disabled/>
                            </div>
                            <div class="form-wrap disabled">
                                <p class="form-title">고객번호</p>
                                <input type="text" class="form-control form-lg" placeholder="" value="00001247"
                                       disabled/>
                            </div>
                            <div class="form-wrap disabled">
                                <p class="form-title">아이디</p>
                                <input type="text" class="form-control form-lg" placeholder="" value="sougetsu"
                                       disabled/>
                            </div>
                            <div class="form-wrap">
                                <p class="form-title">급식비 런치카드 충전</p>
                                <select name="chargeAmount" id="chargeAmount" class="form-select">
                                    <option value="10000">10,000원</option>
                                    <option value="20000">20,000원</option>
                                    <option value="30000">30,000원</option>
                                </select>
                            </div>
                            <div class="total-payment-price">
                                <p class="title">결제금액</p>
                                <p class="price">10,000 <span>원</span></p>
                            </div>
                        </div>
                        <div class="payment-btn">
                            <button type="button" id="btn-payment" class="btn btn-dark btn-lg w-100">결제하기</button>
                        </div>
                    </div>
                    <div class="commnet-wrap">
                        <ul>
                            <li>※ 학교 급식비 런치카드 충전 결제(충전 결제된 금액은 충전된 날짜부터 6개월 이내에 사용 가능합니다.)</li>
                            <li>※ 신한은행 카드 소유자 본인 : 신한은행 규정 변경으로 인해 해당 카드의 충전/결제는 1일 1회, 최대 50,000원으로 제한됩니다.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('btn-payment')?.addEventListener('click', function () {
            const amountInput = document.getElementById('chargeAmount');
            const amount = amountInput ? parseInt(amountInput.value, 10) : 10000;

            const orderData = {
                orderNo: 'ORDER_' + Date.now(),
                productName: '급식비 런치카드 충전',
                amount: amount
            };

            fetch('/easypay/request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            })
                .then(res => res.json())
                .then(data => {
                    console.log("결제 응답:", data);
                    if (data.authPageUrl) {
                        window.location.href = data.authPageUrl;
                    } else {
                        alert("결제창 URL을 받아오지 못했습니다.");
                    }
                })
                .catch(err => {
                    console.error('결제 요청 오류:', err);
                    alert('결제 중 오류가 발생했습니다.');
                });
        });
    </script>
</div>
</html>